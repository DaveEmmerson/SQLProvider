<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Composable Queries
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Type providers for SQL server access.">
    <meta name="author" content="Ross McKinlay, Colin Bull">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="../content/style.css" />
    <script type="text/javascript" src="../content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/fsprojects/SQLProvider">github page</a></li>
        </ul>
        <h3 class="muted"><a href="../index.html">SQLProvider</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Composable-Queries" class="anchor" href="#Composable-Queries">Composable Queries</a></h1>
<h2><a name="Definition-of-Composable-Queries" class="anchor" href="#Definition-of-Composable-Queries">Definition of Composable Queries</a></h2>
<p>Basicly composable methods are those that you can chain together to build the desired functionality out of smaller parts.
By passing functions as parameters you are able to generate higher-order query operations.
Therefore composable query means that you can do logics to compose just one database-SQL-query from multiple queryables.
By using composable queries you can shorten the Database transactions and keep the connection open a minimum of time.</p>
<h2><a name="Generate-composable-queries-by-using-Linq-IQueryable" class="anchor" href="#Generate-composable-queries-by-using-Linq-IQueryable">Generate composable queries by using Linq IQueryable</a></h2>
<p>With composable queries you can combine two queries in multiple ways, and one query can be used as the building block for the other query.
To see how this works, letâ€™s look at a simple query:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 21)" onmouseover="showTip(event, 'fs16', 21)" class="i">query1</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs17', 22)" onmouseover="showTip(event, 'fs17', 22)" class="i">query</span> {
      <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 23)" onmouseover="showTip(event, 'fs18', 23)" class="i">customers</span>  <span class="k">in</span> <span onmouseout="hideTip(event, 'fs14', 24)" onmouseover="showTip(event, 'fs14', 24)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 25)" onmouseover="showTip(event, 'fs19', 25)" class="i">Main</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 26)" onmouseover="showTip(event, 'fs20', 26)" class="i">Customers</span> <span class="k">do</span>
      <span onmouseout="hideTip(event, 'fs21', 27)" onmouseover="showTip(event, 'fs21', 27)" class="k">where</span> (<span onmouseout="hideTip(event, 'fs18', 28)" onmouseover="showTip(event, 'fs18', 28)" class="i">customers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 29)" onmouseover="showTip(event, 'fs22', 29)" class="i">ContactTitle</span> <span class="o">=</span> <span class="s">&quot;USA&quot;</span>)
      <span onmouseout="hideTip(event, 'fs23', 30)" onmouseover="showTip(event, 'fs23', 30)" class="k">select</span> (<span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="i">customers</span>)}
</code></pre></td>
</tr>
</table>
<p>The variable that is returned from the query is sometimes called a computation. If you write evaluate
(e.g. a foreach loop or <code>|&gt; Seq.toList</code>) and display the address field from the customers returned by this
computation, you see the following output:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">GREAL</span>|<span class="i">Great</span> <span class="i">Lakes</span> <span class="i">Food</span> <span class="i">Market</span>|<span class="i">Howard</span> <span class="i">Snyder</span>|<span class="i">Marketing</span> <span class="i">Manager</span>|<span class="n">2732</span> <span class="i">Baker</span> <span class="i">Blvd</span><span class="o">.</span><span class="o">|</span><span class="i">Eugene</span>|<span class="i">OR</span>|<span class="n">97403</span>|<span class="i">USA</span>|(<span class="n">503</span>) <span class="n">555</span><span class="o">-</span><span class="n">7555</span>|
<span class="i">HUNGC</span>|<span class="i">Hungry</span> <span class="i">Coyote</span> <span class="i">Import</span> <span class="i">Store</span>|<span class="i">Yoshi</span> <span class="i">Latimer</span>|<span class="i">Sales</span> <span class="i">Representative</span>|<span class="i">City</span> <span class="i">Center</span> <span class="i">Plaza</span> <span class="n">516</span> <span class="i">Main</span> <span class="i">St</span><span class="o">.</span><span class="o">|</span><span class="i">Elgin</span>|<span class="i">OR</span>|<span class="n">97827</span>|<span class="i">USA</span>|(<span class="n">503</span>) <span class="n">555</span><span class="o">-</span><span class="n">6874</span>|(<span class="n">503</span>) <span class="n">555</span><span class="o">-</span><span class="n">2376</span>
<span class="o">..</span><span class="o">.</span>
<span class="i">TRAIH</span>|<span class="i">Trail&#39;s</span> <span class="i">Head</span> <span class="i">Gourmet</span> <span class="i">Provisioners</span>|<span class="i">Helvetius</span> <span class="i">Nagy</span>|<span class="i">Sales</span> <span class="i">Associate</span>|<span class="n">722</span> <span class="i">DaVinci</span> <span class="i">Blvd</span><span class="o">.</span><span class="o">|</span><span class="i">Kirkland</span>|<span class="i">WA</span>|<span class="n">98034</span>|<span class="i">USA</span>|(<span class="n">206</span>) <span class="n">555</span><span class="o">-</span><span class="n">8257</span>|(<span class="n">206</span>) <span class="n">555</span><span class="o">-</span><span class="n">2174</span>
<span class="i">WHITC</span>|<span class="i">White</span> <span class="i">Clover</span> <span class="i">Markets</span>|<span class="i">Karl</span> <span class="i">Jablonski</span>|<span class="i">Owner</span>|<span class="n">305</span> <span class="o">-</span> <span class="n">14th</span> <span class="i">Ave</span><span class="o">.</span> <span class="i">S</span><span class="o">.</span> <span class="i">Suite</span> <span class="n">3B</span>|<span class="i">Seattle</span>|<span class="i">WA</span>|<span class="n">98128</span>|<span class="i">USA</span>|(<span class="n">206</span>) <span class="n">555</span><span class="o">-</span><span class="n">4112</span>|(<span class="n">206</span>) <span class="n">555</span><span class="o">-</span><span class="n">4115</span>
</code></pre></td>
</tr>
</table>
<p>You can now write a second query against the result of this query:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 32)" onmouseover="showTip(event, 'fs24', 32)" class="i">query2</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33)" class="i">query</span> {
      <span class="k">for</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="i">customers</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs16', 35)" onmouseover="showTip(event, 'fs16', 35)" class="i">query1</span> <span class="k">do</span>
      <span onmouseout="hideTip(event, 'fs21', 36)" onmouseover="showTip(event, 'fs21', 36)" class="k">where</span> (<span onmouseout="hideTip(event, 'fs18', 37)" onmouseover="showTip(event, 'fs18', 37)" class="i">customers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 38)" onmouseover="showTip(event, 'fs25', 38)" class="i">CompanyName</span> <span class="o">=</span> <span class="s">&quot;The Big Cheese&quot;</span>)
      <span onmouseout="hideTip(event, 'fs23', 39)" onmouseover="showTip(event, 'fs23', 39)" class="k">select</span> <span onmouseout="hideTip(event, 'fs18', 40)" onmouseover="showTip(event, 'fs18', 40)" class="i">customers</span>}
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 41)" onmouseover="showTip(event, 'fs26', 41)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 42)" onmouseover="showTip(event, 'fs27', 42)" class="f">toArray</span>
</code></pre></td>
</tr>
</table>
<p>Notice that the last word in the first line of this query is the computation returned from the previous query.
This second query produces the following output:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">THEBI</span>|<span class="i">The</span> <span class="i">Big</span> <span class="i">Cheese</span>|<span class="i">Liz</span> <span class="i">Nixon</span>|<span class="i">Marketing</span> <span class="i">Manager</span>|<span class="n">89</span> <span class="i">Jefferson</span> <span class="i">Way</span> <span class="i">Suite</span> <span class="n">2</span>|<span class="i">Portland</span>|<span class="i">OR</span>|<span class="n">97201</span>|<span class="i">USA</span>|(<span class="n">503</span>) <span class="n">555</span><span class="o">-</span><span class="n">3612</span>|
</code></pre></td>
</tr>
</table>
<p>SQLProvider to Objects queries are composable because they operate on and usually return variables of type <code>IQueryable&lt;T&gt;</code>.
In other words, SQLProvider queries typically follow this pattern:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> (<span onmouseout="hideTip(event, 'fs28', 43)" onmouseover="showTip(event, 'fs28', 43)" class="i">query</span><span class="o">:</span><span class="i">IQueryable</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>) <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs28', 44)" onmouseover="showTip(event, 'fs28', 44)" class="i">query</span> {
        <span class="c">//for is like C# foreach</span>
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs29', 45)" onmouseover="showTip(event, 'fs29', 45)" class="i">x</span> <span class="k">in</span> (<span class="i">xs</span><span class="o">:</span><span class="i">IQueryable</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>) <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs23', 46)" onmouseover="showTip(event, 'fs23', 46)" class="k">select</span> <span onmouseout="hideTip(event, 'fs29', 47)" onmouseover="showTip(event, 'fs29', 47)" class="i">x</span>
    }

<span class="c">// </span>
</code></pre></td>
</tr>
</table>
<p>This is a simple mechanism to understand, but it yields powerful results.
It allows you to take complex problems, break them into manageable pieces, and solve them with code that is easy to understand and easy to maintain.</p>
<h3><a name="Generate-composable-queries-by-using-NET-LINQ-functions-with-IQueryable" class="anchor" href="#Generate-composable-queries-by-using-NET-LINQ-functions-with-IQueryable">Generate composable queries by using .NET LINQ functions with IQueryable.</a></h3>
<p>The difference between IEnumerable and IQueryable is basically that IEnumerable is executed in the IL while IQueryable can be translated as en expression tree to some other context (like a database query).
They are both lazy by nature, meaning they arenâ€™t evaluated until you enumerate over the results.</p>
<p>Here an example:</p>
<p>First you have to add .NET LINQ:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs30', 48)" onmouseover="showTip(event, 'fs30', 48)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 49)" onmouseover="showTip(event, 'fs31', 49)" class="i">Linq</span>
</code></pre></td>
</tr>
</table>
<p>Then you can define a composable query outside the main query</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 50)" onmouseover="showTip(event, 'fs32', 50)" class="f">companyNameFilter</span> <span onmouseout="hideTip(event, 'fs33', 51)" onmouseover="showTip(event, 'fs33', 51)" class="i">inUse</span> <span onmouseout="hideTip(event, 'fs34', 52)" onmouseover="showTip(event, 'fs34', 52)" class="i">queryable</span> <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 53)" onmouseover="showTip(event, 'fs35', 53)" class="f">queryable</span><span class="o">:</span>(<span onmouseout="hideTip(event, 'fs36', 54)" onmouseover="showTip(event, 'fs36', 54)" class="t">IQueryable</span><span class="o">&lt;</span><span class="i">CustomersEntity</span><span class="o">&gt;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs36', 55)" onmouseover="showTip(event, 'fs36', 55)" class="t">IQueryable</span><span class="o">&lt;</span><span class="i">CustomersEntity</span><span class="o">&gt;</span>) <span class="o">=</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs33', 56)" onmouseover="showTip(event, 'fs33', 56)" class="i">inUse</span> <span class="k">with</span>
        |<span class="k">true</span> <span class="k">-&gt;</span>
            (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 57)" onmouseover="showTip(event, 'fs37', 57)" class="i">iq</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs37', 58)" onmouseover="showTip(event, 'fs37', 58)" class="i">iq</span><span class="o">.</span><span class="i">Where</span>(<span class="k">fun</span> (<span class="i">c</span><span class="o">:</span><span class="i">CustomersEntity</span>) <span class="k">-&gt;</span> <span class="i">c</span><span class="o">.</span><span class="i">CompanyName</span> <span class="o">=</span> <span class="s">&quot;The Big Cheese&quot;</span>))
        |<span class="k">false</span> <span class="k">-&gt;</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs37', 59)" onmouseover="showTip(event, 'fs37', 59)" class="i">iq</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs37', 60)" onmouseover="showTip(event, 'fs37', 60)" class="i">iq</span><span class="o">.</span><span class="i">Where</span>(<span class="k">fun</span> (<span class="i">c</span><span class="o">:</span><span class="i">CustomersEntity</span>) <span class="k">-&gt;</span> <span class="i">c</span>))
    <span onmouseout="hideTip(event, 'fs35', 61)" onmouseover="showTip(event, 'fs35', 61)" class="f">queryable</span>
</code></pre></td>
</tr>
</table>
<p>(Let's asume that your inUse some complex data:
E.g. Your sub-queries would come from other functions. Basic booleans you can just include to your where-clause)</p>
<p>Then you can create the main query</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 62)" onmouseover="showTip(event, 'fs38', 62)" class="i">query1</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs39', 63)" onmouseover="showTip(event, 'fs39', 63)" class="i">query</span> {
        <span class="k">for</span> <span class="i">customers</span>  <span class="k">in</span> <span onmouseout="hideTip(event, 'fs14', 64)" onmouseover="showTip(event, 'fs14', 64)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 65)" onmouseover="showTip(event, 'fs19', 65)" class="i">Main</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 66)" onmouseover="showTip(event, 'fs20', 66)" class="i">Customers</span> <span class="k">do</span>
        <span class="i">where</span> (<span class="i">customers</span><span class="o">.</span><span class="i">ContactTitle</span> <span class="o">=</span> <span class="s">&quot;USA&quot;</span>)
        <span class="i">select</span> (<span class="i">customers</span>)}
</code></pre></td>
</tr>
</table>
<p>and now call you are able to call the second query like this</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 67)" onmouseover="showTip(event, 'fs40', 67)" class="i">query2</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs32', 68)" onmouseover="showTip(event, 'fs32', 68)" class="f">companyNameFilter</span> <span class="k">true</span> <span onmouseout="hideTip(event, 'fs38', 69)" onmouseover="showTip(event, 'fs38', 69)" class="i">query1</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 70)" onmouseover="showTip(event, 'fs26', 70)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 71)" onmouseover="showTip(event, 'fs27', 71)" class="f">toArray</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 72)" onmouseover="showTip(event, 'fs41', 72)" class="i">qry1</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs39', 73)" onmouseover="showTip(event, 'fs39', 73)" class="i">query</span> { <span class="k">for</span> <span class="i">u</span> <span class="k">in</span> <span class="i">dbContext</span><span class="o">.</span><span class="i">Users</span> <span class="k">do</span>
                <span class="i">select</span> (<span class="i">u</span><span class="o">.</span><span class="i">Id</span>, <span class="i">u</span><span class="o">.</span><span class="i">Name</span>, <span class="i">u</span><span class="o">.</span><span class="i">Email</span>)
        }

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 74)" onmouseover="showTip(event, 'fs42', 74)" class="i">qry2</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs39', 75)" onmouseover="showTip(event, 'fs39', 75)" class="i">query</span> { <span class="k">for</span> <span class="i">c</span> <span class="k">in</span> <span class="i">dbContext</span><span class="o">.</span><span class="i">Cars</span> <span class="k">do</span>
                <span class="i">select</span> (<span class="i">c</span><span class="o">.</span><span class="i">UserId</span>, <span class="i">c</span><span class="o">.</span><span class="i">Brand</span>, <span class="i">c</span><span class="o">.</span><span class="i">Year</span>)
        }

    <span onmouseout="hideTip(event, 'fs39', 76)" onmouseover="showTip(event, 'fs39', 76)" class="i">query</span> { <span class="k">for</span> (<span class="i">i</span>,<span class="i">n</span>,<span class="i">e</span>) <span class="k">in</span> <span onmouseout="hideTip(event, 'fs41', 77)" onmouseover="showTip(event, 'fs41', 77)" class="i">qry1</span> <span class="k">do</span>
            <span class="i">join</span> (<span class="i">u</span>,<span class="i">b</span>,<span class="i">y</span>) <span class="k">in</span> <span onmouseout="hideTip(event, 'fs42', 78)" onmouseover="showTip(event, 'fs42', 78)" class="i">qry2</span> <span class="i">on</span> (<span class="i">i</span> <span class="o">=</span> <span class="i">u</span>)
            <span class="i">where</span> (<span class="i">y</span> <span class="o">&gt;</span> <span class="n">2015</span>)
            <span class="i">select</span> (<span class="i">i</span>,<span class="i">n</span>,<span class="i">e</span>,<span class="i">u</span>,<span class="i">b</span>,<span class="i">y</span>)
        } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 79)" onmouseover="showTip(event, 'fs26', 79)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 80)" onmouseover="showTip(event, 'fs27', 80)" class="f">toArray</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Generate-composable-queries-by-using-FSharp-Linq-ComposableQuery" class="anchor" href="#Generate-composable-queries-by-using-FSharp-Linq-ComposableQuery">Generate composable queries by using FSharp.Linq.ComposableQuery</a></h3>
<p>The SQLProvider also supports composable queries by integrating following library FSharpLinqComposableQuery.
You can read more about that library here: <a href="http://fsprojects.github.io/FSharp.Linq.ComposableQuery">FSharp.Linq.ComposableQuery</a></p>
<p>Because it is implemented in the SQLProvider you dont need to add FSharpComposableQuery in your script.</p>
<p>Example for using FSharpComposableQuery</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 81)" onmouseover="showTip(event, 'fs43', 81)" class="i">qry1</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs39', 82)" onmouseover="showTip(event, 'fs39', 82)" class="i">query</span> { <span class="k">for</span> <span class="i">u</span> <span class="k">in</span> <span class="i">dbContext</span><span class="o">.</span><span class="i">Users</span> <span class="k">do</span>
            <span class="i">select</span> (<span class="i">u</span><span class="o">.</span><span class="i">Id</span>, <span class="i">u</span><span class="o">.</span><span class="i">Name</span>, <span class="i">u</span><span class="o">.</span><span class="i">Email</span>)
    }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 83)" onmouseover="showTip(event, 'fs44', 83)" class="i">qry2</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs39', 84)" onmouseover="showTip(event, 'fs39', 84)" class="i">query</span> { <span class="k">for</span> <span class="i">c</span> <span class="k">in</span> <span class="i">dbContext</span><span class="o">.</span><span class="i">Cars</span> <span class="k">do</span>
            <span class="i">select</span> (<span class="i">c</span><span class="o">.</span><span class="i">UserId</span>, <span class="i">c</span><span class="o">.</span><span class="i">Brand</span>, <span class="i">c</span><span class="o">.</span><span class="i">Year</span>)
    }

<span onmouseout="hideTip(event, 'fs39', 85)" onmouseover="showTip(event, 'fs39', 85)" class="i">query</span> { <span class="k">for</span> (<span class="i">i</span>,<span class="i">n</span>,<span class="i">e</span>) <span class="k">in</span> <span onmouseout="hideTip(event, 'fs43', 86)" onmouseover="showTip(event, 'fs43', 86)" class="i">qry1</span> <span class="k">do</span>
        <span class="i">join</span> (<span class="i">u</span>,<span class="i">b</span>,<span class="i">y</span>) <span class="k">in</span> <span onmouseout="hideTip(event, 'fs44', 87)" onmouseover="showTip(event, 'fs44', 87)" class="i">qry2</span> <span class="i">on</span> (<span class="i">i</span> <span class="o">=</span> <span class="i">u</span>)
        <span class="i">where</span> (<span class="i">y</span> <span class="o">&gt;</span> <span class="n">2015</span>)
        <span class="i">select</span> (<span class="i">i</span>,<span class="i">n</span>,<span class="i">e</span>,<span class="i">u</span>,<span class="i">b</span>,<span class="i">y</span>)
    } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 88)" onmouseover="showTip(event, 'fs26', 88)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 89)" onmouseover="showTip(event, 'fs27', 89)" class="f">toArray</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Nested-Select-Where-Queries" class="anchor" href="#Nested-Select-Where-Queries">Nested Select Where Queries</a></h3>
<p>You can create a query like <code>SELECT * FROM xs WHERE xs.x IN (SELECT y FROM ys))</code>
with either LINQ Contains or custom operators: in <code>|=|</code> and not-in <code>|&lt;&gt;|</code>
This is done by not saying <code>|&gt; Seq.toArray</code> to the first query:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs30', 90)" onmouseover="showTip(event, 'fs30', 90)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 91)" onmouseover="showTip(event, 'fs31', 91)" class="i">Linq</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs45', 92)" onmouseover="showTip(event, 'fs45', 92)" class="i">nestedQueryTest</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 93)" onmouseover="showTip(event, 'fs41', 93)" class="i">qry1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 94)" onmouseover="showTip(event, 'fs39', 94)" class="i">query</span> {
        <span class="k">for</span> <span class="i">emp</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs14', 95)" onmouseover="showTip(event, 'fs14', 95)" class="i">ctx</span><span class="o">.</span><span class="i">Hr</span><span class="o">.</span><span class="i">Employees</span> <span class="k">do</span>
        <span class="i">where</span> (<span class="i">emp</span><span class="o">.</span><span class="i">FirstName</span><span class="o">.</span><span class="i">StartsWith</span>(<span class="s">&quot;S&quot;</span>))
        <span class="i">select</span> (<span class="i">emp</span><span class="o">.</span><span class="i">FirstName</span>)
    }
    <span onmouseout="hideTip(event, 'fs39', 96)" onmouseover="showTip(event, 'fs39', 96)" class="i">query</span> {
        <span class="k">for</span> <span class="i">emp</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs14', 97)" onmouseover="showTip(event, 'fs14', 97)" class="i">ctx</span><span class="o">.</span><span class="i">Hr</span><span class="o">.</span><span class="i">Employees</span> <span class="k">do</span>
        <span class="i">where</span> (<span onmouseout="hideTip(event, 'fs41', 98)" onmouseover="showTip(event, 'fs41', 98)" class="i">qry1</span><span class="o">.</span><span class="i">Contains</span>(<span class="i">emp</span><span class="o">.</span><span class="i">FirstName</span>))
        <span class="i">select</span> (<span class="i">emp</span><span class="o">.</span><span class="i">FirstName</span>, <span class="i">emp</span><span class="o">.</span><span class="i">LastName</span>)
    } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs26', 99)" onmouseover="showTip(event, 'fs26', 99)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 100)" onmouseover="showTip(event, 'fs27', 100)" class="f">toArray</span>
</code></pre></td>
</tr>
</table>

<div class="tip" id="fs1">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs2">val connectionString : string<br /><br />Full name: Composable.connectionString</div>
<div class="tip" id="fs3">val resolutionPath : string<br /><br />Full name: Composable.resolutionPath</div>
<div class="tip" id="fs4">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs5">Multiple items<br />namespace FSharp.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs6">namespace FSharp.Data.Sql</div>
<div class="tip" id="fs7">type sql = SqlDataProvider&lt;...&gt;<br /><br />Full name: Composable.sql</div>
<div class="tip" id="fs8">type SqlDataProvider<br /><br />Full name: FSharp.Data.Sql.SqlDataProvider<br /><em><br /><br />&lt;summary&gt;Typed representation of a database&lt;/summary&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;ConnectionString&#39;&gt;The connection string for the SQL database&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;ConnectionStringName&#39;&gt;The connection string name to select from a configuration file&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;DatabaseVendor&#39;&gt; The target database vendor&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;IndividualsAmount&#39;&gt;The amount of sample entities to project into the type system for each SQL entity type. Default 1000.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;UseOptionTypes&#39;&gt;If true, F# option types will be used in place of nullable database columns.  If false, you will always receive the default value of the column&#39;s type even if it is null in the database.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;ResolutionPath&#39;&gt;The location to look for dynamically loaded assemblies containing database vendor specific connections and custom types.&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;Owner&#39;&gt;The owner of the schema for this provider to resolve (Oracle Only)&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;CaseSensitivityChange&#39;&gt;Should we do ToUpper or ToLower when generating table names?&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;TableNames&#39;&gt;Comma separated table names list to limit a number of tables in big instances. The names can have &#39;%&#39; sign to handle it as in the &#39;LIKE&#39; query (Oracle and MSSQL Only)&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;OdbcQuote&#39;&gt;Odbc quote characters: Quote characters for the table and column names: `alias`, [alias]&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;SQLiteLibrary&#39;&gt;Use System.Data.SQLite or Mono.Data.SQLite or select automatically (SQLite only)&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</em></div>
<div class="tip" id="fs9">namespace FSharp.Data.Sql.Common</div>
<div class="tip" id="fs10">type DatabaseProviderTypes =<br />&#160;&#160;|  MSSQLSERVER  =  0<br />&#160;&#160;|  SQLITE  =  1<br />&#160;&#160;|  POSTGRESQL  =  2<br />&#160;&#160;|  MYSQL  =  3<br />&#160;&#160;|  ORACLE  =  4<br />&#160;&#160;|  MSACCESS  =  5<br />&#160;&#160;|  ODBC  =  6<br /><br />Full name: FSharp.Data.Sql.Common.DatabaseProviderTypes</div>
<div class="tip" id="fs11">Common.DatabaseProviderTypes.SQLITE: Common.DatabaseProviderTypes = 1</div>
<div class="tip" id="fs12">type CaseSensitivityChange =<br />&#160;&#160;|  ORIGINAL  =  0<br />&#160;&#160;|  TOUPPER  =  1<br />&#160;&#160;|  TOLOWER  =  2<br /><br />Full name: FSharp.Data.Sql.Common.CaseSensitivityChange</div>
<div class="tip" id="fs13">Common.CaseSensitivityChange.ORIGINAL: Common.CaseSensitivityChange = 0</div>
<div class="tip" id="fs14">val ctx : SqlDataProvider&lt;...&gt;.dataContext<br /><br />Full name: Composable.ctx</div>
<div class="tip" id="fs15">SqlDataProvider&lt;...&gt;.GetDataContext() : SqlDataProvider&lt;...&gt;.dataContext<br /><em><br /><br />&lt;summary&gt;Returns an instance of the SQL Provider using the static parameters&lt;/summary&gt;</em><br />SqlDataProvider&lt;...&gt;.GetDataContext(connectionString: string) : SqlDataProvider&lt;...&gt;.dataContext<br /><em><br /><br />&lt;summary&gt;Returns an instance of the SQL Provider&lt;/summary&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;connectionString&#39;&gt;The database connection string&lt;/param&gt;</em><br />SqlDataProvider&lt;...&gt;.GetDataContext(connectionString: string, resolutionPath: string) : SqlDataProvider&lt;...&gt;.dataContext<br /><em><br /><br />&lt;summary&gt;Returns an instance of the SQL Provider&lt;/summary&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;connectionString&#39;&gt;The database connection string&lt;/param&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;param name=&#39;resolutionPath&#39;&gt;The location to look for dynamically loaded assemblies containing database vendor specific connections and custom types&lt;/param&gt;</em></div>
<div class="tip" id="fs16">val query1 : System.Linq.IQueryable&lt;SqlDataProvider&lt;...&gt;.dataContext.main.CustomersEntity&gt;<br /><br />Full name: Composable.query1</div>
<div class="tip" id="fs17">val query : Linq.QueryBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.query</div>
<div class="tip" id="fs18">val customers : SqlDataProvider&lt;...&gt;.dataContext.main.CustomersEntity</div>
<div class="tip" id="fs19">property SqlDataProvider&lt;...&gt;.dataContext.Main: SqlDataProvider&lt;...&gt;.dataContext.mainSchema</div>
<div class="tip" id="fs20">property SqlDataProvider&lt;...&gt;.dataContext.mainSchema.Customers: SqlDataProvider&lt;...&gt;.dataContext.mainSchema.main.Customers<br /><em><br /><br />&lt;summary&gt;The table Customers belonging to schema main&lt;/summary&gt;</em></div>
<div class="tip" id="fs21">custom operation: where (bool)<br /><br />Calls Linq.QueryBuilder.Where </div>
<div class="tip" id="fs22">property SqlDataProvider&lt;...&gt;.dataContext.main.CustomersEntity.ContactTitle: string</div>
<div class="tip" id="fs23">custom operation: select (&#39;Result)<br /><br />Calls Linq.QueryBuilder.Select </div>
<div class="tip" id="fs24">val query2 : SqlDataProvider&lt;...&gt;.dataContext.main.CustomersEntity []<br /><br />Full name: Composable.query2</div>
<div class="tip" id="fs25">property SqlDataProvider&lt;...&gt;.dataContext.main.CustomersEntity.CompanyName: string</div>
<div class="tip" id="fs26">Multiple items<br />module Seq<br /><br />from FSharp.Data.Sql<br /><br />--------------------<br />module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs27">val toArray : source:seq&lt;&#39;T&gt; -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toArray</div>
<div class="tip" id="fs28">val query : System.Linq.IQueryable&lt;obj&gt;<br /><br />Full name: Composable.query</div>
<div class="tip" id="fs29">val x : obj</div>
<div class="tip" id="fs30">namespace System</div>
<div class="tip" id="fs31">namespace System.Linq</div>
<div class="tip" id="fs32">val companyNameFilter : inUse:bool -&gt; queryable:&#39;a -&gt; (&#39;b -&gt; &#39;c)<br /><br />Full name: Composable.companyNameFilter</div>
<div class="tip" id="fs33">val inUse : bool</div>
<div class="tip" id="fs34">val queryable : &#39;a</div>
<div class="tip" id="fs35">val queryable : (&#39;b -&gt; &#39;c)</div>
<div class="tip" id="fs36">Multiple items<br />type IQueryable =<br />&#160;&#160;member ElementType : Type<br />&#160;&#160;member Expression : Expression<br />&#160;&#160;member Provider : IQueryProvider<br /><br />Full name: System.Linq.IQueryable<br /><br />--------------------<br />type IQueryable&lt;&#39;T&gt; =<br /><br />Full name: System.Linq.IQueryable&lt;_&gt;</div>
<div class="tip" id="fs37">val iq : &#39;b</div>
<div class="tip" id="fs38">val query1 : obj<br /><br />Full name: Composable.query1</div>
<div class="tip" id="fs39">val query : IQueryable&lt;obj&gt;<br /><br />Full name: Composable.query</div>
<div class="tip" id="fs40">val query2 : obj []<br /><br />Full name: Composable.query2</div>
<div class="tip" id="fs41">val qry1 : obj</div>
<div class="tip" id="fs42">val qry2 : obj</div>
<div class="tip" id="fs43">val qry1 : obj<br /><br />Full name: Composable.qry1</div>
<div class="tip" id="fs44">val qry2 : obj<br /><br />Full name: Composable.qry2</div>
<div class="tip" id="fs45">val nestedQueryTest : obj []<br /><br />Full name: Composable.nestedQueryTest</div>

        </div>
        <div class="span3">
          <ul class="nav nav-list" id="menu">
            <li class="nav-header">SQLProvider</li>
            <li><a href="../index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/SQLProvider">Get Library via NuGet</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider/blob/master/LICENSE.txt">License</a></li>
            <li><a href="http://github.com/fsprojects/SQLProvider/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            
        
            <li class="nav-header">Documentation</li>
              <li><a href="../core/general.html">General</a></li>
              <li><a href="../core/parameters.html">Static Parameters</a></li>
              <li><a href="../core/querying.html">Querying</a></li>
              <li><a href="../core/constraints-relationships.html">Constraints & Relationships</a></li>
              <li><a href="../core/crud.html">CRUD</a></li>
              <li><a href="../core/programmability.html">Programmability</a></li>
              <li><a href="../core/individuals.html">Individuals</a></li>
              <li><a href="../core/composable.html">Composable Query</a></li>
              <li><a href="../core/mssql.html">SQL Server</a></li>
              <li><a href="../core/oracle.html">Oracle</a></li>
              <li><a href="../core/sqlite.html">SQLite</a></li>
              <li><a href="../core/postgresql.html">PostgreSQL</a></li>
              <li><a href="../core/mysql.html">MySQL</a></li>
              <li><a href="../core/odbc.html">ODBC</a></li>
              <li><a href="../reference/index.html">Internal API Docs</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsprojects/SQLProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>
